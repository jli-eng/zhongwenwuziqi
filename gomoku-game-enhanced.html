<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº”å­æ£‹ä¸­æ–‡è¯è¯­æ¯”èµ›</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        * {
            box-sizing: border-box;
        }
        body {
            font-family: 'Comic Sans MS', 'Microsoft YaHei', sans-serif;
            text-align: center;
            background-color: #f9f7f7;
            padding: 10px;
            margin: 0;
            overflow: auto;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .game-container {
            max-width: 100%;
            margin: 0 auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        h1 {
            color: #ff85a2;
            margin: 10px 0;
            font-size: min(8vw, 48px);
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        .settings-group {
            margin: 15px 0;
            padding: 0 10px;
        }
        .custom-words, .timer-setting {
            margin-bottom: 15px;
        }
        .settings-group label {
            display: block;
            color: #666;
            font-size: min(4vw, 16px);
            margin-bottom: 5px;
            text-align: left;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }
        .custom-words input, .timer-setting input {
            width: 100%;
            max-width: 600px;
            padding: 12px 15px;
            border: 2px solid #e8c4c4;
            border-radius: 50px;
            font-size: min(4vw, 18px);
            outline: none;
            transition: all 0.3s;
        }
        .custom-words input:focus, .timer-setting input:focus {
            border-color: #ff9a9e;
            box-shadow: 0 0 0 3px rgba(255,154,158,0.2);
        }
        .custom-words p, .timer-setting p {
            color: #666;
            font-size: min(3.5vw, 14px);
            margin: 5px 0 0 0;
            text-align: left;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }
        .start-options {
            margin: 15px 0;
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        .start-btn {
            padding: 12px 24px;
            border-radius: 50px;
            border: none;
            font-size: min(5vw, 20px);
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
        }
        .start-btn:hover {
            transform: scale(1.05);
        }
        .team1-start {
            background: linear-gradient(135deg, #ffd5cd, #ff9a9e);
            color: #ff6b6b;
        }
        .team2-start {
            background: linear-gradient(135deg, #d0e6ff, #a1c4fd);
            color: #4d96ff;
        }
        .current-word-container {
            background-color: #fffacd;
            border-radius: 15px;
            padding: 10px;
            margin: 10px auto;
            width: 90%;
            max-width: 800px;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.1);
            position: relative;
        }
        .current-word {
            font-size: min(12vw, 72px);
            color: #2f4f4f;
            min-height: 1.5em;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            padding: 10px;
            word-break: break-all;
        }
        /* å€’è®¡æ—¶æ ·å¼ */
        .timer-container {
            position: absolute;
            top: -15px;
            right: 20px;
        }
        .timer-circle {
            width: min(12vw, 60px);
            height: min(12vw, 60px);
            position: relative;
        }
        .timer-progress {
            fill: none;
            stroke-width: 6;
            stroke-linecap: round;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
            transition: stroke-dashoffset 1s linear, stroke 0.5s ease;
        }
        .timer-background {
            fill: none;
            stroke-width: 6;
            stroke: #f0f0f0;
        }
        .timer-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: min(5vw, 24px);
            font-weight: bold;
            color: #000000; /* å€’è®¡æ—¶ä¸­å¿ƒæ•°å­—æ”¹ä¸ºé»‘è‰² */
            text-shadow: 0 1px 2px rgba(255,255,255,0.5); /* å¢åŠ ç™½è‰²é˜´å½±æé«˜å¯è¯»æ€§ */
        }
        .team-indicator {
            font-size: min(5vw, 28px);
            margin: 10px 0;
            padding: 10px 20px;
            border-radius: 50px;
            display: inline-block;
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
        }
        .team1-indicator {
            background: linear-gradient(135deg, #ffd5cd, #ff9a9e);
            color: #ff6b6b;
        }
        .team2-indicator {
            background: linear-gradient(135deg, #d0e6ff, #a1c4fd);
            color: #4d96ff;
        }
        .board-container {
            margin: 10px auto;
            max-width: 100%;
            overflow: auto;
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .board {
            display: grid;
            grid-template-columns: repeat(15, min(6vw, 50px));
            grid-template-rows: repeat(15, min(6vw, 50px));
            gap: 2px;
            background-color: #f5e6ca;
            border: 4px solid #e8c4c4;
            border-radius: 10px;
            padding: 5px;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.1);
            margin: 0 auto;
        }
        .cell {
            width: 100%;
            height: 100%;
            background-color: #fff9f0;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s;
        }
        .cell:hover {
            background-color: #fff0e0;
            transform: scale(0.95);
        }
        .piece {
            width: 80%;
            height: 80%;
            border-radius: 50%;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
            transition: all 0.3s;
        }
        .team1-piece {
            background: linear-gradient(135deg, #ff9a9e, #fad0c4);
            border: 2px solid #ff6b6b;
        }
        .team2-piece {
            background: linear-gradient(135deg, #a1c4fd, #c2e9fb);
            border: 2px solid #4d96ff;
        }
        .controls {
            margin: 15px 0;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: min(3vw, 20px);
        }
        .control-btn {
            width: min(15vw, 80px);
            height: min(15vw, 80px);
            border-radius: 50%;
            background: linear-gradient(135deg, #a8edea, #fed6e3);
            color: white;
            border: none;
            font-size: min(6vw, 28px);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .control-btn:hover {
            transform: scale(1.1) rotate(10deg);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        .control-btn:disabled {
            background: #e0e0e0;
            cursor: not-allowed;
            transform: none;
            color: #b0b0b0;
        }
        #correctBtn {
            background: linear-gradient(135deg, #a1ffce, #faffd1);
            color: #4CAF50;
        }
        #wrongBtn {
            background: linear-gradient(135deg, #ff9a9e, #fad0c4);
            color: #ff6b6b;
        }
        #nextBtn {
            background: linear-gradient(135deg, #a1c4fd, #c2e9fb);
            color: #4d96ff;
        }
        #resetBtn {
            background: linear-gradient(135deg, #ffc3a0, #ffafbd);
            color: #ff6b6b;
        }
        
        /* å¤§å±å¹•çƒŸèŠ±æ•ˆæœ */
        .firework {
            position: fixed;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            box-shadow: 0 0 20px 5px;
            animation: firework-animation 2s ease-out;
            opacity: 0;
            z-index: 100;
        }
        
        @keyframes firework-animation {
            0% {
                transform: translate(var(--x), var(--y)) scale(0);
                opacity: 1;
            }
            50% {
                opacity: 1;
            }
            100% {
                transform: translate(var(--x-end), var(--y-end)) scale(1.5);
                opacity: 0;
            }
        }
        
        .win-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: min(8vw, 60px);
            font-weight: bold;
            color: white;
            text-shadow: 0 0 15px #000;
            z-index: 200;
            animation: zoomIn 0.5s, float 3s ease-in-out infinite;
            padding: 20px 40px;
            border-radius: 20px;
            box-shadow: 0 15px 30px rgba(0,0,0,0.3);
            text-align: center;
            max-width: 90%;
        }
        
        @keyframes zoomIn {
            from {
                transform: translate(-50%, -50%) scale(0.5);
                opacity: 0;
            }
            to {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
        }
        
        @keyframes float {
            0%, 100% {
                transform: translate(-50%, -50%) translateY(0);
            }
            50% {
                transform: translate(-50%, -50%) translateY(-20px);
            }
        }
        
        .hidden {
            display: none;
        }
        
        .timeout-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: min(6vw, 40px);
            font-weight: bold;
            color: white;
            background-color: rgba(255, 69, 0, 0.9);
            padding: 20px 40px;
            border-radius: 20px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            z-index: 150;
            animation: fadeInOut 2s;
        }
        
        @keyframes fadeInOut {
            0%, 100% {
                opacity: 0;
            }
            20%, 80% {
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>ğŸŒˆ äº”å­æ£‹ä¸­æ–‡è¯è¯­æ¯”èµ› ğŸŒˆ</h1>
        
        <div id="startScreen">
            <div class="settings-group">
                <div class="custom-words">
                    <label for="customWordsInput">è‡ªå®šä¹‰è¯è¯­</label>
                    <input type="text" id="customWordsInput" placeholder="è¾“å…¥è‡ªå®šä¹‰è¯è¯­ï¼Œç”¨ç©ºæ ¼åˆ†éš”ï¼ˆå¯é€‰ï¼‰">
                    <p>æç¤ºï¼šå¦‚æœä¸è¾“å…¥ï¼Œå°†ä½¿ç”¨é»˜è®¤è¯è¯­åº“</p>
                </div>
                <div class="timer-setting">
                    <label for="timerInput">å€’è®¡æ—¶è®¾ç½®ï¼ˆç§’ï¼‰</label>
                    <input type="number" id="timerInput" min="1" max="60" value="10">
                    <p>æç¤ºï¼šè¯·è¾“å…¥1-60ä¹‹é—´çš„æ•°å­—ï¼Œè®¾ç½®æ¯ä¸ªè¯è¯­çš„æ€è€ƒæ—¶é—´</p>
                </div>
            </div>
            <div class="start-options">
                <button class="start-btn team1-start" id="team1StartBtn">çº¢é˜Ÿå…ˆæ‰‹</button>
                <button class="start-btn team2-start" id="team2StartBtn">è“é˜Ÿå…ˆæ‰‹</button>
            </div>
        </div>
        
        <div id="gameScreen" class="hidden">
            <div class="team-indicator" id="teamIndicator"></div>
            
            <div class="current-word-container">
                <div class="timer-container">
                    <svg class="timer-circle" viewBox="0 0 100 100">
                        <circle class="timer-background" cx="50" cy="50" r="40"></circle>
                        <circle class="timer-progress" cx="50" cy="50" r="40" 
                                stroke="#ff3366" stroke-dasharray="251.2" stroke-dashoffset="0"></circle>
                    </svg>
                    <div class="timer-text" id="timer">10</div>
                </div>
                <div class="current-word" id="currentWord"></div>
            </div>
            
            <div class="controls">
                <button class="control-btn" id="correctBtn" title="æ­£ç¡®"><i class="fas fa-check"></i></button>
                <button class="control-btn" id="wrongBtn" title="é”™è¯¯"><i class="fas fa-times"></i></button>
                <button class="control-btn" id="nextBtn" title="ä¸‹ä¸€ä¸ªè¯"><i class="fas fa-forward"></i></button>
                <button class="control-btn" id="resetBtn" title="é‡æ–°å¼€å§‹"><i class="fas fa-redo"></i></button>
            </div>
            
            <div class="board-container">
                <div class="board" id="board"></div>
            </div>
        </div>
    </div>

    <script>
        // é»˜è®¤è¯è¯­åº“
        const defaultWords = [
            "è¿åŠ¨", "æ¸¸æ³³", "å–œæ¬¢", "è¸¢è¶³çƒ", "æ‰“ç¯®çƒ", 
            "å»", "èµ°", "å¿™", "å¯¹ä¸èµ·", "æ²¡å…³ç³»", 
            "è¯·é—®", "æœ€", "å›½å®¶", "å¤–è¯­", "æ³•è¯­", 
            "å¾—", "å“ªé‡Œ", "è¯´", "ä¼š", "æ±‰è¯­"
        ];
        
        let words = [...defaultWords]; // å½“å‰ä½¿ç”¨çš„è¯è¯­åº“
        let usedWords = [];
        let currentWord = "";
        let currentTeam = 1; // 1 for team1, 2 for team2
        let board = Array(15).fill().map(() => Array(15).fill(0)); // 0 empty, 1 team1, 2 team2
        let gameOver = false;
        let consecutiveFails = 0; // è®°å½•è¿ç»­å¤±è´¥çš„æ¬¡æ•°
        const maxConsecutiveFails = 2; // æœ€å¤§è¿ç»­å¤±è´¥æ¬¡æ•°åæ¢è¯
        let timer;
        let timeLeft = 10;
        let timerDuration = 10; // å€’è®¡æ—¶æ—¶é•¿ï¼Œé»˜è®¤10ç§’
        
        // DOMå…ƒç´ 
        const startScreen = document.getElementById("startScreen");
        const gameScreen = document.getElementById("gameScreen");
        const team1StartBtn = document.getElementById("team1StartBtn");
        const team2StartBtn = document.getElementById("team2StartBtn");
        const currentWordEl = document.getElementById("currentWord");
        const teamIndicatorEl = document.getElementById("teamIndicator");
        const timerEl = document.getElementById("timer");
        const timerProgressEl = document.querySelector(".timer-progress");
        const correctBtn = document.getElementById("correctBtn");
        const wrongBtn = document.getElementById("wrongBtn");
        const nextBtn = document.getElementById("nextBtn");
        const resetBtn = document.getElementById("resetBtn");
        const boardEl = document.getElementById("board");
        const customWordsInput = document.getElementById("customWordsInput");
        const timerInput = document.getElementById("timerInput");
        
        // è®¡ç®—åœ†çš„å‘¨é•¿ï¼ˆç”¨äºè¿›åº¦æ¡ï¼‰
        const circleCircumference = 2 * Math.PI * 40; // r=40
        
        // åˆ›å»ºçƒŸèŠ±æ•ˆæœ
        function createFireworks(count, color) {
            for (let i = 0; i < count; i++) {
                setTimeout(() => {
                    const firework = document.createElement("div");
                    firework.className = "firework";
                    firework.style.color = color;
                    
                    // éšæœºèµ·å§‹ä½ç½®
                    const startX = Math.random() * window.innerWidth;
                    const startY = Math.random() * window.innerHeight;
                    
                    // éšæœºç»“æŸä½ç½®
                    const angle = Math.random() * Math.PI * 2;
                    const distance = 100 + Math.random() * 200;
                    const endX = startX + Math.cos(angle) * distance;
                    const endY = startY + Math.sin(angle) * distance;
                    
                    firework.style.setProperty("--x", `${startX}px`);
                    firework.style.setProperty("--y", `${startY}px`);
                    firework.style.setProperty("--x-end", `${endX - startX}px`);
                    firework.style.setProperty("--y-end", `${endY - startY}px`);
                    
                    document.body.appendChild(firework);
                    
                    // åŠ¨ç”»ç»“æŸåç§»é™¤å…ƒç´ 
                    setTimeout(() => {
                        firework.remove();
                    }, 2000);
                }, i * 100);
            }
        }
        
        // æ˜¾ç¤ºè·èƒœæ¶ˆæ¯å’ŒçƒŸèŠ±
        function showWinMessage(team) {
            const teamName = team === 1 ? "çº¢é˜Ÿ" : "è“é˜Ÿ";
            const teamColor = team === 1 ? "#ff6b6b" : "#4d96ff";
            
            const winMessage = document.createElement("div");
            winMessage.className = "win-message";
            winMessage.textContent = `ğŸ‰ æ­å–œ ${teamName} è·èƒœï¼ ğŸ‰`;
            winMessage.style.background = team === 1 
                ? "linear-gradient(135deg, rgba(255,107,107,0.8), rgba(255,154,158,0.8))" 
                : "linear-gradient(135deg, rgba(77,150,255,0.8), rgba(161,196,253,0.8))";
            document.body.appendChild(winMessage);
            
            // åˆ›å»ºçƒŸèŠ±
            createFireworks(30, teamColor);
            
            // 3ç§’åç§»é™¤æ¶ˆæ¯
            setTimeout(() => {
                winMessage.remove();
            }, 3000);
        }
        
        // æ˜¾ç¤ºè¶…æ—¶æ¶ˆæ¯
        function showTimeoutMessage() {
            const timeoutMessage = document.createElement("div");
            timeoutMessage.className = "timeout-message";
            timeoutMessage.textContent = "æ—¶é—´åˆ°ï¼";
            document.body.appendChild(timeoutMessage);
            
            // 2ç§’åç§»é™¤æ¶ˆæ¯
            setTimeout(() => {
                timeoutMessage.remove();
            }, 2000);
        }
        
        // å¼€å§‹å€’è®¡æ—¶
        function startTimer() {
            clearInterval(timer);
            timeLeft = timerDuration;
            updateTimerDisplay();
            
            // è®¾ç½®è¿›åº¦æ¡åˆå§‹çŠ¶æ€
            timerProgressEl.style.strokeDasharray = circleCircumference;
            timerProgressEl.style.strokeDashoffset = 0;
            
            timer = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    showTimeoutMessage();
                    handleTimeout();
                }
            }, 1000);
        }
        
        // æ›´æ–°è®¡æ—¶å™¨æ˜¾ç¤º
        function updateTimerDisplay() {
            timerEl.textContent = timeLeft;
            
            // æ›´æ–°è¿›åº¦æ¡
            const progress = timeLeft / timerDuration;
            const offset = circleCircumference * (1 - progress);
            timerProgressEl.style.strokeDashoffset = offset;
            
            // æ ¹æ®å‰©ä½™æ—¶é—´æ”¹å˜é²œäº®é¢œè‰²
            if (timeLeft <= timerDuration / 3) {
                // æ—¶é—´è¾ƒå°‘æ—¶ä½¿ç”¨é²œäº®çº¢è‰²
                timerProgressEl.style.stroke = "#ff3333";
            } else if (timeLeft <= timerDuration * 2 / 3) {
                // æ—¶é—´ä¸­ç­‰æ—¶ä½¿ç”¨é²œäº®æ©™è‰²
                timerProgressEl.style.stroke = "#ff9900";
            } else {
                // æ—¶é—´å……è¶³æ—¶ä½¿ç”¨é²œäº®ç²‰è‰²
                timerProgressEl.style.stroke = "#ff3366";
            }
        }
        
        // å¤„ç†è¶…æ—¶
        function handleTimeout() {
            // è¶…æ—¶åç›¸å½“äºè®¤è¯»é”™è¯¯
            consecutiveFails++;
            
            // å¦‚æœä¸¤é˜Ÿéƒ½è¶…æ—¶äº†è¿™ä¸ªè¯è¯­ï¼Œè‡ªåŠ¨æ¢ä¸€ä¸ªæ–°è¯
            if (consecutiveFails >= maxConsecutiveFails) {
                consecutiveFails = 0;
                usedWords.push(currentWord); // æ ‡è®°å½“å‰è¯ä¸ºå·²ä½¿ç”¨
                showNextWord();
                currentWordEl.textContent = `æ–°è¯: ${currentWord}`;
                return;
            }
            
            switchTeam();
            currentWordEl.textContent = `è½®åˆ° ${currentTeam === 1 ? "ğŸˆ çº¢é˜Ÿ" : "ğŸˆ è“é˜Ÿ"} è¯»: ${currentWord}`;
        }
        
        // åˆå§‹åŒ–æ£‹ç›˜
        function initBoard() {
            boardEl.innerHTML = "";
            for (let i = 0; i < 15; i++) {
                for (let j = 0; j < 15; j++) {
                    const cell = document.createElement("div");
                    cell.className = "cell";
                    cell.dataset.row = i;
                    cell.dataset.col = j;
                    cell.addEventListener("click", () => placePiece(i, j));
                    boardEl.appendChild(cell);
                }
            }
        }
        
        // è·å–éšæœºè¯è¯­ï¼ˆå¾ªç¯ä½¿ç”¨ï¼‰
        function getRandomWord() {
            // å¦‚æœæ‰€æœ‰è¯è¯­éƒ½å·²ä½¿ç”¨è¿‡ï¼Œé‡ç½®usedWordsæ•°ç»„
            if (usedWords.length === words.length) {
                usedWords = [];
            }
            
            // ä»å°šæœªä½¿ç”¨çš„è¯è¯­ä¸­éšæœºé€‰æ‹©
            const availableWords = words.filter(word => !usedWords.includes(word));
            return availableWords[Math.floor(Math.random() * availableWords.length)];
        }
        
        // æ˜¾ç¤ºä¸‹ä¸€ä¸ªè¯è¯­
        function showNextWord() {
            if (gameOver) return;
            
            currentWord = getRandomWord();
            currentWordEl.textContent = currentWord;
            nextBtn.disabled = true;
            updateTeamIndicator();
            startTimer(); // å¼€å§‹æ–°çš„å€’è®¡æ—¶
        }
        
        // æ›´æ–°é˜Ÿä¼æŒ‡ç¤ºå™¨
        function updateTeamIndicator() {
            if (currentTeam === 1) {
                teamIndicatorEl.className = "team-indicator team1-indicator";
                teamIndicatorEl.textContent = "ğŸˆ çº¢é˜Ÿå›åˆ";
            } else {
                teamIndicatorEl.className = "team-indicator team2-indicator";
                teamIndicatorEl.textContent = "ğŸˆ è“é˜Ÿå›åˆ";
            }
        }
        
        // æ”¾ç½®æ£‹å­
        function placePiece(row, col) {
            if (gameOver || board[row][col] !== 0 || !currentWord) return;
            
            // é‡ç½®è®¡æ—¶å™¨
            clearInterval(timer);
            
            board[row][col] = currentTeam;
            const cell = document.querySelector(`.cell[data-row="${row}"][data-col="${col}"]`);
            const piece = document.createElement("div");
            piece.className = `piece team${currentTeam}-piece`;
            
            // æ·»åŠ ä¸‹è½åŠ¨ç”»
            piece.style.transform = "scale(0)";
            cell.appendChild(piece);
            setTimeout(() => {
                piece.style.transform = "scale(1)";
            }, 10);
            
            // æ£€æŸ¥æ˜¯å¦è·èƒœ
            if (checkWin(row, col)) {
                gameOver = true;
                showWinMessage(currentTeam);
            }
            
            // æ ‡è®°è¯è¯­ä¸ºå·²ä½¿ç”¨
            usedWords.push(currentWord);
            consecutiveFails = 0; // é‡ç½®è¿ç»­å¤±è´¥è®¡æ•°
            
            currentWord = "";
            currentWordEl.textContent = "âœ¨ è¯·ç‚¹å‡»ä¸‹ä¸€ä¸ªè¯ âœ¨";
            nextBtn.disabled = false;
        }
        
        // æ£€æŸ¥æ˜¯å¦äº”å­è¿ç 
        function checkWin(row, col) {
            const directions = [
                [0, 1],  // æ°´å¹³
                [1, 0],  // å‚ç›´
                [1, 1],  // å¯¹è§’çº¿
                [1, -1]  // åå¯¹è§’çº¿
            ];
            
            const team = board[row][col];
            
            for (const [dx, dy] of directions) {
                let count = 1;
                
                // æ­£å‘æ£€æŸ¥
                for (let i = 1; i < 5; i++) {
                    const newRow = row + i * dx;
                    const newCol = col + i * dy;
                    if (newRow < 0 || newRow >= 15 || newCol < 0 || newCol >= 15 || board[newRow][newCol] !== team) {
                        break;
                    }
                    count++;
                }
                
                // åå‘æ£€æŸ¥
                for (let i = 1; i < 5; i++) {
                    const newRow = row - i * dx;
                    const newCol = col - i * dy;
                    if (newRow < 0 || newRow >= 15 || newCol < 0 || newCol >= 15 || board[newRow][newCol] !== team) {
                        break;
                    }
                    count++;
                }
                
                if (count >= 5) {
                    return true;
                }
            }
            
            return false;
        }
        
        // åˆ‡æ¢é˜Ÿä¼
        function switchTeam() {
            currentTeam = currentTeam === 1 ? 2 : 1;
            updateTeamIndicator();
            startTimer(); // åˆ‡æ¢é˜Ÿä¼åå¼€å§‹æ–°çš„å€’è®¡æ—¶
        }
        
        // é‡ç½®æ¸¸æˆ
        function resetGame() {
            clearInterval(timer);
            startScreen.classList.remove("hidden");
            gameScreen.classList.add("hidden");
            
            usedWords = [];
            currentWord = "";
            board = Array(15).fill().map(() => Array(15).fill(0));
            gameOver = false;
            consecutiveFails = 0;
            timeLeft = timerDuration;
            
            boardEl.innerHTML = "";
        }
        
        // å¤„ç†è‡ªå®šä¹‰è¯è¯­
        function processCustomWords() {
            const customWords = customWordsInput.value.trim();
            if (customWords) {
                // ç”¨ç©ºæ ¼åˆ†å‰²å¹¶è¿‡æ»¤ç©ºå­—ç¬¦ä¸²
                const wordsArray = customWords.split(/\s+/).filter(word => word);
                if (wordsArray.length > 0) {
                    return wordsArray;
                }
            }
            // å¦‚æœæ²¡æœ‰è‡ªå®šä¹‰è¯è¯­æˆ–æ ¼å¼ä¸æ­£ç¡®ï¼Œä½¿ç”¨é»˜è®¤è¯è¯­
            return [...defaultWords];
        }
        
        // å¤„ç†å€’è®¡æ—¶è®¾ç½® - å…è®¸æ›´çµæ´»çš„æ—¶é—´è®¾ç½®
        function processTimerSetting() {
            let timerValue = parseInt(timerInput.value, 10);
            
            // ç¡®ä¿æ•°å€¼åœ¨æ›´å®½æ³›çš„æœ‰æ•ˆèŒƒå›´å†…
            if (isNaN(timerValue) || timerValue < 1) {
                timerValue = 1;
            } else if (timerValue > 60) {
                timerValue = 60;
            }
            
            timerInput.value = timerValue;
            return timerValue;
        }
        
        // å¼€å§‹æ¸¸æˆ
        function startGame(startingTeam) {
            currentTeam = startingTeam;
            // å¤„ç†è‡ªå®šä¹‰è¯è¯­
            words = processCustomWords();
            // å¤„ç†å€’è®¡æ—¶è®¾ç½®
            timerDuration = processTimerSetting();
            startScreen.classList.add("hidden");
            gameScreen.classList.remove("hidden");
            
            initBoard();
            updateTeamIndicator();
            showNextWord();
        }
        
        // äº‹ä»¶ç›‘å¬
        correctBtn.addEventListener("click", () => {
            if (!currentWord || gameOver) return;
            
            // è¯»å¯¹äº†ï¼Œå¯ä»¥ä¸‹å­
            clearInterval(timer); // åœæ­¢è®¡æ—¶å™¨
            consecutiveFails = 0; // é‡ç½®è¿ç»­å¤±è´¥è®¡æ•°
            document.querySelectorAll(".cell").forEach(cell => {
                cell.style.cursor = "pointer";
            });
            currentWordEl.textContent = `${currentTeam === 1 ? "ğŸˆ çº¢é˜Ÿ" : "ğŸˆ è“é˜Ÿ"} è¯·ä¸‹å­: ${currentWord}`;
        });
        
        wrongBtn.addEventListener("click", () => {
            if (!currentWord || gameOver) return;
            
            clearInterval(timer); // åœæ­¢è®¡æ—¶å™¨
            
            // è¯»é”™äº†ï¼Œæ¢é˜Ÿ
            consecutiveFails++;
            
            // å¦‚æœä¸¤é˜Ÿéƒ½è¯»é”™äº†è¿™ä¸ªè¯è¯­ï¼Œè‡ªåŠ¨æ¢ä¸€ä¸ªæ–°è¯
            if (consecutiveFails >= maxConsecutiveFails) {
                consecutiveFails = 0;
                usedWords.push(currentWord); // æ ‡è®°å½“å‰è¯ä¸ºå·²ä½¿ç”¨
                showNextWord();
                currentWordEl.textContent = `æ–°è¯: ${currentWord}`;
                return;
            }
            
            switchTeam();
            currentWordEl.textContent = `è½®åˆ° ${currentTeam === 1 ? "ğŸˆ çº¢é˜Ÿ" : "ğŸˆ è“é˜Ÿ"} è¯»: ${currentWord}`;
        });
        
        nextBtn.addEventListener("click", () => {
            if (gameOver) return;
            
            clearInterval(timer); // åœæ­¢è®¡æ—¶å™¨
            switchTeam();
            showNextWord();
            document.querySelectorAll(".cell").forEach(cell => {
                cell.style.cursor = "default";
            });
        });
        
        resetBtn.addEventListener("click", resetGame);
        
        team1StartBtn.addEventListener("click", () => startGame(1));
        team2StartBtn.addEventListener("click", () => startGame(2));
        
        // é™åˆ¶å€’è®¡æ—¶è¾“å…¥åªèƒ½æ˜¯æ•°å­—ä¸”åœ¨1-60ä¹‹é—´
        timerInput.addEventListener("input", () => {
            let value = timerInput.value;
            // ç§»é™¤éæ•°å­—å­—ç¬¦
            value = value.replace(/[^0-9]/g, '');
            timerInput.value = value;
            
            // è‡ªåŠ¨è°ƒæ•´åˆ°æœ‰æ•ˆèŒƒå›´
            const numValue = parseInt(value, 10);
            if (!isNaN(numValue)) {
                if (numValue < 1) timerInput.value = 1;
                else if (numValue > 60) timerInput.value = 60;
            }
        });
    </script>
</body>
</html>
    